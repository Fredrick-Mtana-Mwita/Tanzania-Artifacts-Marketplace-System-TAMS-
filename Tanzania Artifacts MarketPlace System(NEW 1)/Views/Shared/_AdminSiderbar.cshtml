<!-- Theme & Sidebar Toggle -->
<div class="d-flex justify-content-between align-items-center mb-4 px-2">
    <button class="btn btn-sm btn-outline-secondary rounded-pill" onclick="toggleTheme()">
        <i id="themeIcon" class="bi bi-moon-stars-fill"></i>
    </button>

    <button class="btn btn-sm btn-outline-light rounded-pill" onclick="toggleTheme()">
        <i id="themeIcon" class="bi bi-moon-stars-fill"></i>
    </button>
</div>

<!-- Sidebar Links -->
<div class="admin-sidebar list-group list-group-flush">
    <a asp-action="AdminDashboard" asp-controller="Admin"
       class="list-group-item list-group-item-action">
        <i class="bi bi-speedometer2 me-2"></i> Dashboard
    </a>

    <a asp-action="AdminNotifications" asp-controller="Admin"
       class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
        <span>
            <i class="bi bi-bell-fill me-2"></i> Notifications
        </span>
        <span id="sidebarNotificationCount" class="badge bg-danger rounded-pill small" style="display: none;">0</span>
    </a>

    <a asp-action="AdminOrders" asp-controller="Admin"
       class="list-group-item list-group-item-action">
        <i class="bi bi-cart-check me-2"></i> Orders
    </a>

    <a asp-action="ManageUser" asp-controller="Admin"
       class="list-group-item list-group-item-action">
        <i class="bi bi-people-fill me-2"></i> Users
    </a>


    <a asp-action="ApproveSeller" asp-controller="Admin"
       class="list-group-item list-group-item-action">
        <i class="bi bi-person-badge-fill"></i> Approve Sellers
    </a>

    <a asp-action="ApproveProduct" asp-controller="Admin"
       class="list-group-item list-group-item-action">
        <i class="bi bi-check2-circle me-2"></i> Product Approval
    </a>

    <a asp-action="NewsletterSubscription" asp-controller="Admin"
       class="list-group-item list-group-item-action">
        <i class="bi bi-envelope-fill me-2"></i> Newsletter Subscribers
    </a>

    <a asp-action="Reports" asp-controller="Admin"
       class="list-group-item list-group-item-action">
        <i class="bi bi-graph-up me-2"></i> Reports
    </a>

    <a asp-action="BannerManagement" asp-controller="Admin"
       class="list-group-item list-group-item-action">
        <i class="bi bi-image-fill me-2"></i> Banners
    </a>

    <a asp-area="Identity" asp-page="/Account/Logout"
       asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })"
       class="list-group-item list-group-item-action">
        <i class="bi bi-box-arrow-right me-2"></i> Logout
    </a>
</div>

<!-- Toast Container -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1055">
    <div id="notificationToast" class="toast bg-dark text-white shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-primary text-white">
            <i class="bi bi-bell-fill me-2"></i>
            <strong class="me-auto">New Notification</strong>
            <small>Just now</small>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastBody">
            You have a new notification.
        </div>
    </div>
</div>

<!-- Polling Script -->
<script>
    async function fetchNotifications() {
        try {
            const response = await fetch('/Admin/GetNotifications');
            if (!response.ok) return;

            const data = await response.json();
            const count = data.length;

            const badge = document.getElementById("sidebarNotificationCount");
            if (count > 0) {
                badge.style.display = "inline-block";
                badge.textContent = count;

                // Show toast
                const toastEl = document.getElementById("notificationToast");
                const toastBody = document.getElementById("toastBody");
                toastBody.innerHTML = `<strong>${data[0].Title}</strong><br>${data[0].Message}`;
                const toast = new bootstrap.Toast(toastEl);
                toast.show();
            } else {
                badge.style.display = "none";
            }

        } catch (error) {
            console.error("Error fetching notifications:", error);
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        fetchNotifications();
        setInterval(fetchNotifications, 20000); // every 20 seconds
    });
</script>
